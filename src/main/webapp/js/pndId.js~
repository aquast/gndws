/* - pndId.js - */
/*
 * enables GND Triplestore requests for pndIdent within creator Input-fields 
 *
 * Requires jQuery (http://jquery.com/) 
 * author Andres Quast
 */

$(document).ready(addPndForm);


function addPndForm(){
	var suchImage = "<div style=\"float:left;\"><img src=\"../image/search_icon.jpg\" alt=\"PND nach Person durchsuchen\" /></div>";
	var imageDiv = $(".PNDIdentNumber").parent().append(suchImage);
	$("div").addClass("search_icon");
	$("img").click(requestPersonId);
	
};

function requestPersonId(){
    	var firstName = $(this).parent().parent().parent().find(".firstName").val();
	var lastName = $(this).parent().parent().parent().find(".lastName").val();
    //var firstName = $(this + " input.firstName");
	/*$(".result").append("<h2>PNDs für den Namen: </h2>");
	$(".firstName").each(function(){
		var firstName = $(this).val();
		$(".result").append("<p>Vorname : " + firstName + "</p>" + tagEbene);
		
	});*/
	if(pndFormCheck(firstName, lastName)){
		$(".result").append("<p>Name : " + firstName + " " + lastName + "</p>");
		$(".result").append(requestGndService(firstName, lastName)); 	
/*PersonData = window.open("https://alkyoneus.hbz-nrw.de/gnd/gndrequest.jsp?firstName=" + firstName + "&lastName=" + lastName, "Person Data", "height=800,width=600,scrollbars=yes");
    	PersonData.focus();*/
    	}
};

function pndFormCheck(firstName, lastName){
    if(lastName == null || lastName == "" || firstName == null || firstName == ""){
        alert('Füllen Sie bitte zunächst Nach- und Vornamenfelder aus');
    return false;
    }
    return true;
}

function requestGndService(firstName, lastName){
	//return $("<p>" + lastName + ", " + firstName + "</p>");
	var requestUrl = "http://localhost:8080/axis2/services/gndRequester/getGndPersonInfo?firstName=" 
	+ firstName + "&lastName=" + lastName;

	var response = "<p>TEST</p>";
	var options = {
			type: 'GET',
			url: requestUrl,
			dataType: 'xml text',
            	}
            
            	//jQuery.ajax('include.txt');
            	alert('starte Anfrage mit' + requestUrl);
            	
            	var jqxhr = jQuery.ajax(options)
			.done(function(){alert("success");})
			.fail(function(){alert("failed: " + jqxhr.statusCode());})
			.always(function(){alert("complete");});
		//alert(response);
		//alert(jqxhr.status);
            	

}
